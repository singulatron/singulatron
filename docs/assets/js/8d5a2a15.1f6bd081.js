"use strict";(self.webpackChunksingulatron_api_docs=self.webpackChunksingulatron_api_docs||[]).push([[6636],{52724:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var i=n(74848),t=n(28453);const r={sidebar_position:90,tags:["user-svc","permissions","roles","authentication","authorization","service"]},o="User Svc",a={id:"services/user-svc",title:"User Svc",description:"The user service is at the heart of Singulatron, managing users, tokens, organizations, permissions and more. Each service and human on the Singulatron network has an account in the User Svc.",source:"@site/docs/services/user-svc.md",sourceDirName:"services",slug:"/services/user-svc",permalink:"/docs/services/user-svc",draft:!1,unlisted:!1,editUrl:"https://github.com/singulatron/superplatform/tree/main/docs-source/docs/services/user-svc.md",tags:[{inline:!0,label:"user-svc",permalink:"/docs/tags/user-svc"},{inline:!0,label:"permissions",permalink:"/docs/tags/permissions"},{inline:!0,label:"roles",permalink:"/docs/tags/roles"},{inline:!0,label:"authentication",permalink:"/docs/tags/authentication"},{inline:!0,label:"authorization",permalink:"/docs/tags/authorization"},{inline:!0,label:"service",permalink:"/docs/tags/service"}],version:"current",sidebarPosition:90,frontMatter:{sidebar_position:90,tags:["user-svc","permissions","roles","authentication","authorization","service"]},sidebar:"tutorialSidebar",previous:{title:"Deploy Svc",permalink:"/docs/services/deploy-svc"},next:{title:"Contributing",permalink:"/docs/category/contributing"}},c={},l=[{value:"How It Works",id:"how-it-works",level:2},{value:"The Token",id:"the-token",level:3},{value:"Decoding the Token",id:"decoding-the-token",level:3},{value:"Token Structure",id:"token-structure",level:3},{value:"Managing Credentials",id:"managing-credentials",level:2},{value:"Services With Multiple Nodes",id:"services-with-multiple-nodes",level:3},{value:"A Practical Example",id:"a-practical-example",level:3},{value:"Roles",id:"roles",level:2},{value:"Types of Roles",id:"types-of-roles",level:3},{value:"Static",id:"static",level:3},{value:"Dynamic",id:"dynamic",level:4},{value:"Conventions",id:"conventions",level:3},{value:"Permissions",id:"permissions",level:2},{value:"Conventions",id:"conventions-1",level:3}];function d(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"user-svc",children:"User Svc"}),"\n",(0,i.jsxs)(s.p,{children:["The user service is at the heart of Singulatron, managing users, tokens, organizations, permissions and more. Each service and human on the Singulatron network has an account in the ",(0,i.jsx)(s.code,{children:"User Svc"}),"."]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["This page is a high level overview of the ",(0,i.jsx)(s.code,{children:"User Svc"}),". For more details, please see the ",(0,i.jsx)(s.a,{href:"/docs/superplatform/login",children:"User Svc API documentation"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsx)(s.h3,{id:"the-token",children:"The Token"}),"\n",(0,i.jsxs)(s.p,{children:["The User Svc produces a JWT (",(0,i.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/JSON_Web_Token",children:"JSON Web Token"}),") upon ",(0,i.jsx)(s.a,{href:"/docs/superplatform/login",children:"/user-svc/login"})," in the ",(0,i.jsx)(s.code,{children:"token.token"})," field (see the response documentation)."]}),"\n",(0,i.jsxs)(s.p,{children:["You can either use this token as a proper JWT - decode it and inspect the contents, or you can just use the token to read the user account that belongs to the token with the ",(0,i.jsx)(s.a,{href:"/docs/superplatform/read-user-by-token",children:"/user-svc/user/by-token"})," endpoint."]}),"\n",(0,i.jsx)(s.h3,{id:"decoding-the-token",children:"Decoding the Token"}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.a,{href:"/docs/superplatform/get-public-key",children:(0,i.jsx)(s.code,{children:"/user-svc/public-key"})})," will return you the public key of the User Svc which then you can use that to decode the token."]}),"\n",(0,i.jsxs)(s.p,{children:["Use the JWT libraries that are available in your programming language to do that, or use the Singularon ",(0,i.jsx)(s.a,{href:"https://github.com/singulatron/singulatron/tree/main/sdk",children:"SDK"})," if your language is supported."]}),"\n",(0,i.jsx)(s.h3,{id:"token-structure",children:"Token Structure"}),"\n",(0,i.jsx)(s.p,{children:"The structure of the JWT is the following:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-js",children:'{\n   "sui":"usr_dC4K75Cbp6",\n   "slu":"test-user-slug-0",\n   "sri":[\n      "user-svc:user",\n      "user-svc:org:{org_dC4K7NNDCG}:user"\n   ]\n}\n'})}),"\n",(0,i.jsx)(s.p,{children:"The field names are kept short to save space, so perhaps the Go definition is also educational:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:'type Claims struct {\n\tUserId  string   `json:"sui"` // `sui`: singulatron user ids\n\tSlug    string   `json:"slu"` // `slu`: singulatron slug\n\tRoleIds []string `json:"sri"` // `sri`: singulatron role ids\n\tjwt.RegisteredClaims\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"managing-credentials",children:"Managing Credentials"}),"\n",(0,i.jsx)(s.p,{children:"The most important thing about the User Svc is that service (machine) and user (human) accounts look and function the same."}),"\n",(0,i.jsxs)(s.p,{children:["Every service you write needs to ",(0,i.jsx)(s.a,{href:"/docs/superplatform/register",children:"register"})," at startup, or log in with the credentials it saves and manages if it's already regsitered. Just like a human."]}),"\n",(0,i.jsx)(s.p,{children:"You can do this in a few ways:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Use the ",(0,i.jsx)(s.a,{href:"/docs/superplatform/register",children:"API"})," directly"]}),"\n",(0,i.jsxs)(s.li,{children:["Use a language specific ",(0,i.jsx)(s.a,{href:"https://github.com/singulatron/singulatron/tree/main/clients",children:"client"})," that was generated from the API"]}),"\n",(0,i.jsxs)(s.li,{children:["Use a language specific ",(0,i.jsx)(s.a,{href:"https://github.com/singulatron/singulatron/tree/main/localtron/sdk",children:"SDK"})]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"services-with-multiple-nodes",children:"Services With Multiple Nodes"}),"\n",(0,i.jsxs)(s.p,{children:['You might now wonder what happens when a service has multiple instances/nodes. Won\'t their user accounts "clash" in the ',(0,i.jsx)(s.code,{children:"User Svc"}),"? The answer to this is that from the ",(0,i.jsx)(s.code,{children:"User Svc"})," point of view, each node/instance of a service is the same account."]}),"\n",(0,i.jsx)(s.p,{children:'This is possible because the platform is designed with services having a "Shared Database Access".'}),"\n",(0,i.jsxs)(s.p,{children:["Let's say you have a Cassandra network that spans multiple Availability Zones/Regions. Your nodes will also span multiple AZs/Regions and each instance of them will log in as ",(0,i.jsx)(s.code,{children:"X Svc"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"a-practical-example",children:"A Practical Example"}),"\n",(0,i.jsx)(s.p,{children:"A code snippet is worth a thousand words, even if it's in an unfamiliar language, so here is how the Prompt Svc boots up:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-go",children:'func (cs *PromptService) Start() error {\n\ttoken, err := sdk.RegisterService("prompt-svc", "Prompt Service", cs.router, cs.credentialStore)\n\tif err != nil {\n\t\treturn err\n\t}\n\tcs.router = cs.router.SetBearerToken(token)\n\n\treturn cs.registerPermissions()\n}\n'})}),"\n",(0,i.jsx)(s.h2,{id:"roles",children:"Roles"}),"\n",(0,i.jsx)(s.h3,{id:"types-of-roles",children:"Types of Roles"}),"\n",(0,i.jsx)(s.h3,{id:"static",children:"Static"}),"\n",(0,i.jsxs)(s.p,{children:["Static roles, such as ",(0,i.jsx)(s.code,{children:"user-svc:admin"})," and ",(0,i.jsx)(s.code,{children:"user-svc:user"})," defined by the ",(0,i.jsx)(s.code,{children:"User Svc"})," are primarily used for simple role-based access control: in the Singulatron UI and API you can edit static roles to add or remove endpoints a user can call."]}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsxs)(s.p,{children:["If you are looking at restricting access to endpoints in other ways, you might be interested in: ",(0,i.jsx)(s.a,{href:"/docs/services/policy-svc",children:"Policy Svc"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"dynamic",children:"Dynamic"}),"\n",(0,i.jsx)(s.p,{children:"Dynamic roles are generated based on specific user-resource associations, offering more flexible permission management compared to static roles."}),"\n",(0,i.jsxs)(s.p,{children:["Dynamic roles look like ",(0,i.jsx)(s.code,{children:"user-svc:org:{org_dBZRCej3fo}:admin"}),". The dynamic values must be surrounded by ",(0,i.jsx)(s.code,{children:"{}"})," symbols. The above example is how organization roles are represented."]}),"\n",(0,i.jsx)(s.p,{children:"These dynamic roles, like static roles are stored in the JWT tokens so it is advisable to keep them to a minimum. The organization example is an apt one here: think about how many GitHub or Google organizations you are part of. Likely even a few dozen are at the most extreme upper limit."}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsx)(s.p,{children:"JWT tokens (and the dynamic they contain) are sent with each request, so try to be efficient with dynamic roles."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"conventions",children:"Conventions"}),"\n",(0,i.jsx)(s.p,{children:"Each role created must by prefixed by the slug of the account that created it. Said account becomes the owner of the role and only that account can edit the role."}),"\n",(0,i.jsx)(s.h2,{id:"permissions",children:"Permissions"}),"\n",(0,i.jsx)(s.h3,{id:"conventions-1",children:"Conventions"}),"\n",(0,i.jsx)(s.p,{children:"Each permission created must by prefixed by the slug of the account that created it. Said account becomes the owner of the permission and only that account can add the permission to a role."}),"\n",(0,i.jsxs)(s.blockquote,{children:["\n",(0,i.jsx)(s.p,{children:"Once you (your service) own a permission (by creating it, and it being prefixed by your account slug), you can add it to any role, not just roles owned by you."}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Example; let's say your service is ",(0,i.jsx)(s.code,{children:"petstore-svc"}),". Singulatron prefers fine-grained access control, so you are free to define your own permissions, such as ",(0,i.jsx)(s.code,{children:"petstore-svc:read"})," or ",(0,i.jsx)(s.code,{children:"petstore-svc:pet:read"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var i=n(96540);const t={},r=i.createContext(t);function o(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);